#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage{amsthm,amsmath,amssymb,amscd,mathrsfs,url}
%\usepackage[czech]{babel}
\usepackage{verbatim}
%\usepackage{ictamxs}
\usepackage{showkeys}
\usepackage{xcolor}
\usepackage{stackengine}
\usepackage{lipsum}
\usepackage{comment}
%%\usepackage{MNsymbol} NIKDY!
\usepackage{graphicx}
\usepackage{caption}
\usepackage{nomencl}
\usepackage{subcaption}
\usepackage{tikz}
\usepackage[customcolors,shade]{hf-tikz}
\usepackage{marginnote}
\usepackage{esint}
\usepackage{ulem}
\setlength\textwidth{145mm}
\setlength\textheight{247mm}
\setlength{\topmargin}{-2.3cm}          % HORNI ODSAZENI
\setlength{\textheight}{26.0cm}           % VYSKA STRANKY
\setlength{\textwidth}{18cm}          % SIRKA STRANKY, nebo pouzij: \addtolength{\textwidth}{4.0cm}
\addtolength{\oddsidemargin}{-2cm}    % POSUNUTI LEVEHO ODSAZENI, default for book=36mm%%
\addtolength{\evensidemargin}{-2cm}


\newcommand{\opdiv}{\mathop{\mathrm{div}}}
\newcommand{\oprot}{\mathop{\mathrm{rot}}}

\newcommand*\mnote[3][0pt]{%
  \if l#2\reversemarginpar\def\pointer{\filledmedtriangleright}%
    \def\stackalignment{r}\fi%
  \if r#2\normalmarginpar\def\pointer{\filledmedtriangleleft}%
    \def\stackalignment{l}\fi%
  \marginpar{%
    \topinset{%
      \scalebox{1.5}{\textcolor{blue}{$\pointer$}}}{%
      \belowbaseline[-1.5\baselineskip-#1]{%
        \stackengine%
          {-5pt}%
          {\fcolorbox{blue}{white}{\parbox{1.8cm}%
            {\vspace{3pt}\raggedright#3}}}%
          {~\colorbox{white}{\sffamily Pozn.}}%
          {O}%
          {l}%
          {F}%
          {F}%
          {S}%
        }%
      }{%
      3ex+#1}{%
      -2ex}%
  }%
}


\tikzstyle{mybox} = [draw=red, fill=blue!20, very thick,
    rectangle, rounded corners, inner sep=10pt, inner ysep=20pt]
\tikzstyle{fancytitle} =[fill=red, text=white]

\makenomenclature
\end_preamble
\options a4paper,english,czech,12pt
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding utf8
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref true
\pdf_title "2PDE"
\pdf_author "Martin Holi Holecek"
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle true
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 0
\use_package mathdots 0
\use_package mathtools 1
\use_package mhchem 0
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Optimization of operation of renewable electric energy sources based on
 fuel cells, accumulators and FV panels for small powers
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part*
Motivation and introduction
\end_layout

\begin_layout Standard
For better understanding of the whole text, lets imagine a model problem,
 which we can follow through the entire work.
 Lets say, we want to make an energy independent unit - ecologic house,
 for example.
\end_layout

\begin_layout Standard
Lets add renewable energy source (fotovoltaic panels) and a system for storing
 energy.
 Batteries alone are not sufficient, because they would need to be changed,
 due to degradation.
 So lets add availible hydrogen technologies - electrolyzer, hydrogen tank,
 fuel cells.
 And, to finish the setting, backup energy unit (or electric grid).
 The goal is to determine the system parameters (and develop the strategy
 to do so) and power managment strategy in a manner to make the system independe
nt as much as possible (minimizing the consumption of backup energy or energy
 from grid).
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
In this work we want not only solving this problem, but also to make this
 text usefull for future coworkers,
\end_layout

\end_inset


\end_layout

\begin_layout Standard
For now, lets look at the theoretical and practical tools needed to solve
 this problem - in the following part 
\begin_inset Quotes eld
\end_inset

research and previous works
\begin_inset Quotes erd
\end_inset

.
 Later we will return to our model problem, and we will use the tools to
 analyze the setting and rewrite it into mathematical formulation.
 Next we will state arising interesting questions, which we will try to
 answer - to complement other works.
\end_layout

\begin_layout Standard
Lastly, there will be a brief note about developed computer program.
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
At our disposition we will have (or will develop) model for the system with
 equations for parts of the system and supplying datas for daily light current
 and energy demand.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename System.jpg
	lyxscale 50

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Part*
Research and previous works
\end_layout

\begin_layout Standard
Lets summarize other works and interesting ideas from the relevant fields.
\end_layout

\begin_layout Section*
Optimization and hydrogen technology
\end_layout

\begin_layout Standard
Fuel cells and hydrogen technologies (as a part of renewable resources 
\begin_inset CommandInset citation
LatexCommand cite
key "RenewableSources"

\end_inset

), extend the possibilities of energy storage 
\begin_inset CommandInset citation
LatexCommand cite
key "EnergyAccumulation"

\end_inset

 and creates a possibility for research of various systems and using mathematica
l tools to model and optimize theese systems.
 One example of such a system are the standalone energetic units 
\begin_inset CommandInset citation
LatexCommand cite
key "MassimoStandalone"

\end_inset

.
\end_layout

\begin_layout Standard
Some possibilities of optimization theese standalone systems are sumarized
 in 
\begin_inset CommandInset citation
LatexCommand cite
key "ErdincOptimumDesign"

\end_inset

, optimization of standalone energetic units and power managment strategies
 are being researched too (in, for example 
\begin_inset CommandInset citation
LatexCommand cite
key "IpsakisPowerManagmentStrategies"

\end_inset

), and some work is also focused on specific installations 
\begin_inset CommandInset citation
LatexCommand cite
key "Abdelkafi20141"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "Sarioglu20147"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "Taher2014268"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "Cai2014212"

\end_inset

.
\end_layout

\begin_layout Standard
Application of optimization in the theory of optimal control is described
 in the books 
\begin_inset CommandInset citation
LatexCommand cite
key "EvansControlCourse"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "Lewis2012optimal"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "Warga1972optimal"

\end_inset

.
 An example of a method used for global optimization is an application of
 metropolis algorithm, so called Simulated Annealing 
\begin_inset CommandInset citation
LatexCommand cite
key "SimulatedAnnealing"

\end_inset

 (that is used too for the design of electric circuits or in chemistry 
\begin_inset CommandInset citation
LatexCommand cite
key "Chaudhuri1997733"

\end_inset

).
 There is even a method taking in account the uncertainity of data, Stochastic
 Annealing 
\begin_inset CommandInset citation
LatexCommand cite
key "PaintonStochastic"

\end_inset

.
 This method is used in 
\begin_inset CommandInset citation
LatexCommand cite
key "GiannakoudisOptimumDesign"

\end_inset

 for optimization of the parameters of the control strategy.
\end_layout

\begin_layout Standard
Another interesting principle, the Pontryagin principle, is used to prolong
 the lifetime of such systems 
\begin_inset CommandInset citation
LatexCommand cite
key "XuPontryaginStrategy,ProlongingLifetime,ZhengPontryaginProlonging"

\end_inset

, or optimization problems are solved for vehicles 
\begin_inset CommandInset citation
LatexCommand cite
key "Maalej2014668"

\end_inset

.
 In the article 
\begin_inset CommandInset citation
LatexCommand cite
key "CaliseSingleLevel"

\end_inset

, there is proposed an optimal system even for the powerplant of SOFC (solid
 oxide fuel cell) type.
\end_layout

\begin_layout Standard
Needed to say, that often, new algorithms of global optimization are being
 used (ex.
 particle swarm, or genetic algorithms).
 For theese algorithms, the question of convergence is still an open problem
 (about this and another possibilities of algorithms is the text 
\begin_inset CommandInset citation
LatexCommand cite
key "ExperimentalAlgorithms"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Kapitolou optimalizace jsou jednak metody globální optimalizace, které hledají
 nejlepší kombinaci parametrů vzhledem ke zadané funkci a také aplikace
 variačního počtu a funkcionální analýzy na hledání optimální řídící funkce
 pro jistý systém.
 Přirozená dynamika systému a rovnice popisující jeho vývoj se často berou
 v optimalizaci s omezeními právě jako zadaná omezení a pomocí lagrangeových
 multiplikátorů se problémy převádí na optimalizaci bez omezení (unconstrained
 optimization.)
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph*
\begin_inset Note Note
status open

\begin_layout Paragraph*
Optimization
\end_layout

\begin_layout Plain Layout
The method of optimal control is also the dynamic programming, that is usefull
 when we have countably many discrete values of states and controls - in
 case of constrains.
 Else we just suppose the function to be continuous and find the minimum
 by differentiation.
 For continuous functions, we can discretize the values - by time and/or
 by values - (getting a small error) if we want to use the optimality principle.
\end_layout

\begin_layout Plain Layout
--tj optimal control strana 283 
\begin_inset Quotes eld
\end_inset

diskretizace quantizace a interpolace"
\end_layout

\begin_layout Plain Layout
Hamilton Jacobi bellman equation (289)
\end_layout

\end_inset


\end_layout

\begin_layout Section*
Models for batteries, fuel cells, electrolyzer, photovoltaics...
\end_layout

\begin_layout Standard
There are rich availible model descriptions (for example also in 
\begin_inset CommandInset citation
LatexCommand cite
key "vepa2013dynamic"

\end_inset

), complex models (with PDEs) are used for complicated problems and for
 detailed desription of inside processes (for example in a battery), but
 theese models arent meant and suited for simulations.
 More simple models with less variables (for example like curve fitting)
 are better in case we need to evaluate the model more times (as in our
 case).
\end_layout

\begin_layout Subsection*
Photovoltaics
\end_layout

\begin_layout Standard
When looking at photovoltaic (PV) panels, if we want a better model than
 saying 
\begin_inset Quotes eld
\end_inset

general power source", we need to consider that the photoelectric effect
 (the power source) happens at the P-N junction, which is, of course, a
 diode, and that there is some ressistance present.
 Thats the reason, why the following equivalent circuit 
\begin_inset Quotes eld
\end_inset

5 parameter circuit" is used (there exists even the so called 
\begin_inset Quotes eld
\end_inset

7 parameter circuit" which has another diode in parallel to the first diode).
 
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename 275px-Solar_cell_equivalent_circuit.svg.png

\end_inset


\end_layout

\begin_layout Standard
Contruction details, like material used (single crystalline silicon, polycrystal
line and semicrystalline, thin films, amorphous silicon, spheral) or additional
 tricks (concentrated cells, lens, antireflexive and other coating) affect
 the parameters and the efficiency.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
boook votetaukis seferlis str 33; druhej model (kterej sem sem zatim nenapsal,
 je na str 35)
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The circuit supplies current 
\begin_inset Formula $I=I_{pv}$
\end_inset

 at voltage 
\begin_inset Formula $V=V_{pv}$
\end_inset

, 
\begin_inset Formula $I_{L}$
\end_inset

 is generated current by photovoltaic effect and from that we subtract diode
 current and shunt current.
 This way we can derive the model:
\end_layout

\begin_layout Itemize
\begin_inset Formula $I_{pv}=I_{L}-I_{D}-I_{sh}=I_{L}-I_{0}(\exp(\frac{V_{pv}+I_{pv}R_{s}}{\alpha}))-\frac{V_{pv}+I_{pv}R_{s}}{R_{sh}}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{pv}$"
description "Current from photovoltaic model circuit ($A$)"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $I_{L}=C_{1}G,\,I_{0}=C_{2}T^{3}\exp(\frac{-E_{GO}}{kT})$
\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $P_{pv}=V_{pv}I_{pv}\eta_{conv}$
\end_inset

 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$P_{pv}$"
description "Power from photovoltaic model circuit ($J$)"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $\alpha$
\end_inset

 curve fitting parameter (model requires test runs and measurements)
\end_layout

\begin_layout Itemize
\begin_inset Formula $G$
\end_inset

 incident radiation 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$G$"
description "Incident radiation"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $T$
\end_inset

 surface temperature
\end_layout

\begin_layout Itemize
\begin_inset Formula $E_{GO}$
\end_inset

 band gap of the used PV material 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$E_{GO}$"
description "band gap of the used PV material"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $C_{i}$
\end_inset

 constants
\end_layout

\begin_layout Itemize
\begin_inset Formula $I_{L}$
\end_inset

light current
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_L$"
description "light current $A$"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $I_{D}$
\end_inset

diode current 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{D}$"
description "diode current $A$"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $I_{sh}$
\end_inset

shunt current 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{sh}$"
description "shunt current $A$"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $I_{0}$
\end_inset

diode reverse saturation current (comes from the Shockley's diode equation)
 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{0}$"
description "diode reverse saturation current $A$"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $V_{pv}$
\end_inset

, 
\begin_inset Formula $I_{pv}$
\end_inset

, operational voltage and current 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{pv}$"
description "operation voltage (photovoltaic) $V$"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $R_{s}$
\end_inset

, 
\begin_inset Formula $R_{sh}$
\end_inset

, parallel and shunt ressistors 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$R_{s}$"
description "parallel resistor ressistance $Ohm$"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$R_{sh}$"
description "shunt ressistor ressitance $Ohm$"

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $P_{pv}$
\end_inset

, 
\begin_inset Formula $\eta_{conv}$
\end_inset

 output power and effectivity 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$\\eta_{conv}$"
description "effectivity of photovoltaic output power"

\end_inset


\end_layout

\begin_layout Standard
Parameters used to characterize the output of the unit are short circuit
 current, open circuit voltage and maximum power point.
 Nice derivation is in the work 
\begin_inset CommandInset citation
LatexCommand cite
key "Stand-alonePowerSystems"

\end_inset

 together with a method how to compute the parameters from manufacturers
 supplied information from datasheet and notes on behavior with changing
 temperature and finally even a fortran code for PV panels.
 Also, the efficiency of PV energy generation is said to be from 5 to 20%.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Tyjo on tam ma popsany fakt vsechno.
 Budu to resit? Budu resit jak zadavat veci z datasheetu? Alespon je vyjmenuj.
 A co efekty s teplotou?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In a work focused on solar panels and water electrolysis 
\begin_inset CommandInset citation
LatexCommand cite
key "olubukunmi2011solar"

\end_inset

, there is deeper description and analysis and measurement of output power
 dependency on illumination and even thermal effects.
\end_layout

\begin_layout Standard
Needed to say, that detailed analysis of output power includes an observation
 
\begin_inset CommandInset citation
LatexCommand cite
key "voutetakis2011design"

\end_inset

, that there is a maximal power point in the voltage current characteristic;
 this is ideally exploited by a microcontroller, traking this point.
 (In addition this book covers many interesting details, even about AC/DC
 converters.) Algorithms for tracking maximal power point are also being
 developed in 
\begin_inset CommandInset citation
LatexCommand cite
key "beyer2004robust,salas2006review"

\end_inset

, even using neural networks is considered 
\begin_inset CommandInset citation
LatexCommand cite
key "caluianu2011photovoltaic"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
V SolarHydrogenStandAlonePowerSystemIndex.pdf je i fortran code for PV panels.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
(kde najit mereni solar output power: SOlarHydrogenStandAlonePowerSystemIndex.pdf
 str 58 ..
 mimochodem je tam i fortran cod pro FV panel.
 Anebo i zde: www.newquayweather.com/wxsolarpv.php, http://www.cambridge-solar.co.uk/s
olar-pv-cambridge/
\end_layout

\begin_layout Plain Layout
SOlarHydrogenStandAlonePowerSystemIndex.pdf str 78 vysledky power vs cas)
\end_layout

\begin_layout Plain Layout
Jako hodilo by se jeste dat matematickej model pro maximal power point,
 jako kdyby ho to idealne trackovalo.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
Battery
\end_layout

\begin_layout Standard
Why to use both batteries and hydrogen (tanks) to store energy? Batteries
 have higher efficiency, but cant store as much energy as we can with hydrogen.
 Moreover, the state of charge of batteries tends to decrease and batteries
 tends to lose quality over time.
 But using them as quick source, or buffer of energy, is generally a good
 idea, moreover in case, where electrolyzer works better at lower loads,
 battery can lower the load by taking it on itself.
\begin_inset Note Note
status open

\begin_layout Plain Layout
SOlarHydrogenStandAlonePowerSystemIndex.pdf str 77
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The main variables for a battery model are the voltage and state of charge
 (SOC).
 Lets speak about a model of lead acid accumulator from 
\begin_inset CommandInset citation
LatexCommand cite
key "voutetakis2011design"

\end_inset

 - the model is valid for batteries charged more than 20 %, has relations
 for charging and discharging and parameters that need to becomputed experimenta
lly.
 (Needed to say, that there exists models even for overcharged batteries
 and other specific cases.)
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
model - book votetaukis seferlis str 42, najit orig knizku: "photovoltaic
 power supply system with lead acid battery storage" Saupe G
\end_layout

\begin_layout Plain Layout
jinak v tehle knizce, strana 44.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename EqivLeadAcid.png
	lyxscale 20
	scale 20

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
I_{bat}=I_{q}-\frac{Q_{bat,nom}}{10}g_{0}exp(\frac{V_{cell}}{g_{1}}-\frac{g_{2}}{T_{bat}})
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{bat}$"
description "battery current $A$"

\end_inset


\end_layout

\begin_layout Standard
The battery current is the reaction current (
\begin_inset Formula $I_{q}$
\end_inset

) minus the gas current loses, that are modelled using nominal capacity
 of accumulator (
\begin_inset Formula $Q_{bat,nom}$
\end_inset

 in Ah), cell voltage, temperature and gassing current parameters.
 The cell voltage is the equillibrium plus polarization voltage:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
V_{cell}=V_{equ,0}+\frac{V_{equ,l}SOC}{100}+V_{pol}
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{cell}$"
description "cell voltage $V$"

\end_inset


\end_layout

\begin_layout Standard
The equillibrium voltage is approximated linearily by its value at 
\begin_inset Formula $SOC=0$
\end_inset

 and slope 
\begin_inset Formula $V_{equ,l}$
\end_inset

, the polarization voltage is different for charging and discharging (with
 coefficients dependent on the battery):
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
V_{pol,ch} & = & U_{ch}a_{ch}(1-\exp(-\frac{I_{q,norm}}{b_{ch}})+c_{ch}I_{q,norm})\\
V_{pol,dch} & = & U_{dch}(1-\exp(-\frac{I_{q,norm}}{b_{dch}})+c_{dch}I_{q,norm})(1+(g_{100}-1)\exp(\frac{SOC-100}{k_{100}}))
\end{eqnarray*}

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{pol,ch}$"
description "charging polarization voltage $V$"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{pol,dch}$"
description "discharging polarization voltage"

\end_inset


\end_layout

\begin_layout Standard
The indexes 
\begin_inset Quotes eld
\end_inset

ch" stand for charging and 
\begin_inset Quotes eld
\end_inset

dch" for discharging.
 The parameters 
\begin_inset Formula $g_{100},k_{100}$
\end_inset

 are height and slope parametes for fully charged battery (
\begin_inset Formula $SOC=100\%$
\end_inset

).
\end_layout

\begin_layout Standard
A discrete model for a capacity of the battery is 
\begin_inset Formula 
\[
Q_{bat,i}=Q_{bat,i-1}+I_{q}(t_{i}-t_{i-1})=Q_{bat,nom}SOC_{i-1}/100+I_{q}(t_{i}-t_{i-1})
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$Q_{bat.i}$"
description "battery capacity $J$"

\end_inset


\end_layout

\begin_layout Standard
The state of charge of the accumulator is a fraction of the current capacity
 at each time instant divided by its nominal capacity.
 So for 
\begin_inset Formula $SOC$
\end_inset

 we have a model with efficiency (
\begin_inset Formula $\eta_{ac}$
\end_inset

)
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$\\eta_{ac}$"
description "battery efficiency"

\end_inset

, discharge rate (
\begin_inset Formula $\sigma_{ac}$
\end_inset

)
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$\\sigma_{ac}$"
description "battery discharge rate"

\end_inset

 and charge or discharge current 
\begin_inset Formula $I_{ac}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{ac}$"
description "battery current (charge or discharge)"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
SOC(t+1)=SOC(t)(1-\sigma_{ac})+I_{ac}\eta_{ac}(\Delta t)
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $SOC$
\end_inset

 cannot be directly measured, it needs to be derived from the model or indirectl
y from experiements.
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$SOC$"
description "battery state of charge"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
dalsi model je v knizce votetaukis seferlis str 48 ...
 a odkazy na milion dalsich modelu taky ...
\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
Electrolyzer and Fuel cell
\end_layout

\begin_layout Standard
Electrolyzer and fuel cell both basically operate from simple chemical reaction
 (
\begin_inset CommandInset citation
LatexCommand cite
key "rayment2003introduction"

\end_inset

) :
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
H_{2}O\longleftrightarrow H_{2}+\frac{1}{2}O_{2}
\]

\end_inset


\end_layout

\begin_layout Standard
By adding electrical power, the reaction occurs from left side to the right,
 producing hydrogen and oxygen, whereas combining hydrogen and oxygen allows
 us to get the energy back.
 The first way is the basic function of electrolyzer and the latter is of
 the fuel cell.
 By Faradays law, the (molar) quantity of produced/consumed hydrogen is
 proportional to transfered charge.
\end_layout

\begin_layout Standard
Interesting details arise from the exact engeneering of both processes (paramete
rs like temperature, material of electrolyte or membrane, catalyzators etc...),
 anyway the basic common variables are voltage, current and temperature.
\end_layout

\begin_layout Standard
It is good to note, that hydrogen has the best heating value (energy to
 fuel ratio).
 The higher heating value is 
\begin_inset Formula $285.83\,kj\,mol^{-1}$
\end_inset

, the pure standart heat formation of the product water.
 The lower heating value is 
\begin_inset Formula $120\,MJ\,kg^{-1}$
\end_inset

, calculated from the fact, that the product oxygen goes out unused as a
 steam (at said 
\begin_inset Formula $150$
\end_inset

 °C ).
 Electrolysis is not the only way to get hydrogen, other ways are being
 considered too, for example by reforming natural gases.
\end_layout

\begin_layout Subsubsection*
Electrolyzer
\end_layout

\begin_layout Standard
Common types of electrolyzers are alkaline based (operates using an alkaline
 solution) electrolyzers and proton exchange membrane electrolyzer.
\end_layout

\begin_layout Standard
As presented in 
\begin_inset CommandInset citation
LatexCommand cite
key "voutetakis2011design"

\end_inset

, there are many ways to the voltage - current model of the electrolyzer
 - regression, models based on analysis of processes on anothe, cathode
 and membrane (and calculating then V-I relationship by subtracting from
 the open circuit voltage the voltages of activation polarization and ohmic
 polarization), and even rigorous CFD models.
\end_layout

\begin_layout Paragraph*
Butler Volmer equation
\end_layout

\begin_layout Standard
In the work 
\begin_inset CommandInset citation
LatexCommand cite
key "Stand-alonePowerSystems"

\end_inset

, it is noted, that at low voltages, the electrolyzer is more efficient,
 but generates small amounts of hydrogen.
 The Butler-Volmer equation is used to model the system:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
I=I_{0e}(\exp(\frac{(1-\alpha_{e})n_{e}F}{RT}(U-U_{eq}))-\exp(-\frac{\alpha_{e}n_{e}F}{RT}(U-U_{eq})))
\]

\end_inset


\end_layout

\begin_layout Standard
With unknown parameters 
\begin_inset Formula $I_{0e}$
\end_inset

, 
\begin_inset Formula $\alpha_{e}$
\end_inset

 (symmetry factor) and
\begin_inset Formula $U_{eq}$
\end_inset

.
 Hydrogen production rate is computed as follows: 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$n_{H_2}$"
description "hydrogen production rate TODO units $\\frac{mol}{hr \\cdot A}$"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
n_{H_{2}}=\frac{N_{cell}I_{elec}}{n_{e}F}\eta_{F}
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$N_{cell}$"
description "number of cells"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{elec}$"
description "current through electrolyzer $A$"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$\\eta_F$"
description "Faraday efficiency"

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $F$
\end_inset

 is Faraday constant and 
\begin_inset Formula $\eta_{F}$
\end_inset

 is Faraday efficiency (relation between theoretical and actual electron
 transfer, often to be determined by experimental measure), 
\begin_inset Formula $n_{e}=2$
\end_inset

 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$n_e$"
description "TODO"

\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
(SOlarHydrogenStandAlonePowerSystemIndex.pdf str 48)
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph*
One empirical model
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
V_{elec}=V_{rev,elec}+\frac{r_{1}+r_{2}T}{A_{elec}}I_{elec}+(s_{1}+s_{2}T+s_{3}T^{2})\log(\frac{t_{1}+t_{2}/T+t_{3}/T^{2}}{A_{elec}}I_{elec}+1)
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{elec}$"
description "electrolyzer voltage $V$"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$A_{elec}$"
description "area of electrolyzer $m^2$"

\end_inset


\end_layout

\begin_layout Standard
There exists even empirical model for the faraday's efficiency, that takes
 into account the fact, that with decreasing current and/or higher temperatures,
 the parasitic currents increase (because of the electrolyte).
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\eta_{F}=B_{1}+B_{2}\exp(\frac{B_{3}+B_{4}T_{el}+B_{5}T_{el}^{2}}{i})
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$i$"
description "area current $A/m^2$"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
book votetaukis seferlis str 50 ...
 i je plosnej proud, to musim rict.
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
Fuel cell
\end_layout

\begin_layout Standard
The exact process happens in this way:
\begin_inset Note Note
status open

\begin_layout Plain Layout
final amoo str 65.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
H_{2} & \rightarrow & 2H^{+}+2e^{-}\\
\frac{1}{2}O_{2}+2e^{-} & \rightarrow & O^{2-}\\
2H^{+}+O^{2-} & \rightarrow & H_{2}O
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
And the calculation for the amount of hydrogen produced is (from 
\begin_inset CommandInset citation
LatexCommand cite
key "olubukunmi2011solar"

\end_inset

), where 
\begin_inset Formula $\epsilon$
\end_inset

 is the fuel cell efficiency:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
n_{H_{2}}=\frac{1}{\epsilon}\cdot0,01866\frac{mol}{hr\cdot A},\,m_{H_{2}}=\frac{1}{\epsilon}\cdot3,77\cdot10^{-5}\frac{kg}{hr\cdot A}
\]

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$m_{H_2}$"
description "hydrogen production rate (kilograms instead of mols) $\\frac{kg}{hr \\cdot A}$"

\end_inset


\end_layout

\begin_layout Standard
The simplest way to model fuel cell V-I relationship is to look at it as
 a reverse electrolyzer, this course is followed by the following model
 from 
\begin_inset CommandInset citation
LatexCommand cite
key "voutetakis2011design"

\end_inset

.
\begin_inset Note Note
status open

\begin_layout Plain Layout
str 64
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph*
First empiric model
\end_layout

\begin_layout Standard
Takes into account the overvoltages (ohmic and activation), but not effects
 of mass.
 The model computes the cell voltage 
\begin_inset Formula $V_{fc}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{fc}$"
description "fuel cell voltage $V$"

\end_inset

 using open circuit voltage 
\begin_inset Formula $V_{o}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{o}$"
description "open circuit voltage for fuel cell $V$"

\end_inset

, current density 
\begin_inset Formula $i$
\end_inset

, model parameter 
\begin_inset Formula $b$
\end_inset

, current at the inflection point of the V-I curve 
\begin_inset Formula $I_{d}$
\end_inset

 and slope 
\begin_inset Formula $\Delta$
\end_inset

 at the linear stage of ohmic overvoltage:
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$I_{d}$"
description "current at inflection point in fuelcell V-I curve "

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
V_{fc}=E+\frac{b}{\ln(1/I_{d}\,i)}-(\Delta-\frac{b}{4I_{d}})\,i
\]

\end_inset


\end_layout

\begin_layout Standard
The parameters (
\begin_inset Formula $K\in\{E,\,I_{d},\,b,\,\Delta\}$
\end_inset

) 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$K$"
description "general notation for one parameter in empiric model for fuelcells"

\end_inset

 vary with fuel cell temperature 
\begin_inset Formula $T$
\end_inset

 and oxygen partial pressue 
\begin_inset Formula $p_{O_{2}}$
\end_inset

:
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$p_{O_2}$"
description "oxygen partial pressue"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
K=K_{1}+K_{2}T+K_{3}T\ln(p_{O_{2}})
\]

\end_inset


\end_layout

\begin_layout Standard
It is said, that this model is suitable more for low voltages and powers.
 But can be used even for electrolyzer (
\begin_inset Formula $p_{O_{2}}$
\end_inset

 is then the operating pressue for the electrolyzer at which the oxygen
 is produced).
\end_layout

\begin_layout Paragraph*
Second empiric model
\end_layout

\begin_layout Standard
This model takes into effect even the mass transport limitation.
 For computation of a cell voltage 
\begin_inset Formula $V_{fc}$
\end_inset

 and open circuit voltage 
\begin_inset Formula $V_{o}$
\end_inset

, the following applies:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
V_{fc} & = & V_{o}-a_{T}\log(i)-ir+m\exp(il)\\
V_{o} & = & V_{rev,FC}+B\log(i_{o})
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
Where 
\begin_inset Formula $V_{rev,FC}$
\end_inset

 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$V_{rev,fc}$"
description "fuelcell, reversible voltage"

\end_inset

is the reversible voltage, 
\begin_inset Formula $i$
\end_inset

 the current density (fuel cell current per unit area of the electrode,
 in units of milliamps per square centimeter),
\begin_inset Formula $i_{0}$
\end_inset

 and 
\begin_inset Formula $B$
\end_inset

 the Tafel parameter (
\begin_inset Formula $i_{0}$
\end_inset

is the value on the Tafel plot when the current begins to move away from
 zero
\begin_inset Note Note
status open

\begin_layout Plain Layout
FuelCells pdf str 33
\end_layout

\end_inset

), 
\begin_inset Formula $a_{T}$
\end_inset

 the Tafel slope, 
\begin_inset Formula $r$
\end_inset

 the resistance (in 
\begin_inset Formula $\Omega\cdot cm^{2}$
\end_inset

), finally the model parameters 
\begin_inset Formula $m$
\end_inset

, 
\begin_inset Formula $l$
\end_inset

 representing the overvoltage due to mass transport limits.
 All theese parameters can depend on temperature.
\end_layout

\begin_layout Standard
Hydrogen and oxygen then flows according to equations (by Faradays law):
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
H_{2,g}=\frac{N_{cell}I}{2F\eta_{F}},\,O_{2,g}=\frac{N_{cell}I}{4F\eta_{F}}
\]

\end_inset


\end_layout

\begin_layout Standard
All theese models are empirical and are important only because of their
 low computational complexity.
 For greater complexity, there are of course more sophisticated models using
 partial differential equations.
 There is also a nice book about fuel cells, that examines every aspect
 of fuel cell design and explains the details of how fuel cells works 
\begin_inset CommandInset citation
LatexCommand cite
key "larminie2003fuel"

\end_inset

.
\end_layout

\begin_layout Standard
Lets add a word about the storage of hydrogen.
 The possibilities for storage are to store it at the output pressue of
 the electrolyzer, or at higher pressue or liquidified.
 Theese possibilities are covered in most of presented resources and citations.
 If we wanted to store the hydrogen in any other way than at the output
 pressue, we would need to add the compressor into the equation (like it
 is done in 
\begin_inset CommandInset citation
LatexCommand cite
key "voutetakisdesign"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout

\backslash
begin{frame}
\backslash
frametitle{Baterie} 
\backslash
framesubtitle{Rovnice pro části systémů}
\end_layout

\begin_layout Plain Layout
$$SOC(t)=SOC(t-1)(1-
\backslash
sigma)+I_{bat}
\backslash
eta_{bat}(
\backslash
delta t)$$
\end_layout

\begin_layout Plain Layout

\backslash
begin{itemize} 
\backslash
item $SOC(t)$ úroveň nabití baterie 
\backslash
item $
\backslash
sigma$ vliv samovybíjení 
\backslash
item $I_{bat}$ nabíjecí/vybíjecí proud 
\backslash
item $
\backslash
eta_{bat}$ účinnost 
\backslash
end{itemize}
\end_layout

\begin_layout Plain Layout

\backslash
end{frame}
\end_layout

\begin_layout Plain Layout
%%%%% Slide % ------------------------------------------------------------------
---------------------- 
\backslash
begin{frame}
\backslash
frametitle{Elektrolyzér} 
\backslash
framesubtitle{Rovnice pro části systémů} $V_{elec}=V_{rev,elec}+
\backslash
frac{r_1+r_2 T}{A_{elec}} I_{elec}+(s_1+s_2 T+s_3 T^2)
\backslash
log(
\backslash
frac{t_1 + t_2 / T +t_3 / T^2}{A_{elec}}I_{elec}+1)$ $n_{H_2}=n_F 
\backslash
frac{n_c I_{elec}}{n_e F}$ {
\backslash
small 
\backslash
begin{itemize} 
\backslash
item $V_{elec}$ operation cell voltage 
\backslash
item $V_{rev,elec}$ reverzibilní napětí 
\backslash
item $I_{elec}$ operační proud 
\backslash
item $A_{elec}$ plocha elektrody 
\backslash
item $T$ teplota 
\backslash
item $t_i$, $s_i$ parametry přepětí na elektrodách 
\backslash
item $n_{H_2}$ tok vodíku 
\backslash
item $n_F$ účinnost 
\backslash
item $n_c$ počet buněk 
\backslash
item $n_e$ počet elektronů %
\backslash
item $F$ Faradayova konstanta 
\backslash
end{itemize} } 
\backslash
end{frame}
\end_layout

\begin_layout Plain Layout
%%%%% Slide % ------------------------------------------------------------------
---------------------- 
\backslash
begin{frame}
\backslash
frametitle{Vodíkový článek} 
\backslash
framesubtitle{Rovnice pro části systémů} $$V_{fc}=V_0-a_T 
\backslash
log(i)-ir+m 
\backslash
exp(il)$$ $$V_0=V_{rev,FC}+a_T 
\backslash
log(i_0)-ir+m 
\backslash
exp(il)$$ 
\backslash
begin{itemize} 
\backslash
item $V_{fc}$ operační napětí 
\backslash
item $V_{0}$ napětí bez zátěže 
\backslash
item $i$ hustota proudu 
\backslash
item $r$ odpor 
\backslash
item $m$, $l$ parametr přepětí 
\backslash
item $i_0$ parametr článku (Tafel) 
\backslash
item $V_{rev,FC}$ teoretické reverzibilní napětí 
\backslash
item (pro přítok vodíku tatáž rovnice jako pro elektrolyzér) 
\backslash
end{itemize} 
\backslash
end{frame}
\end_layout

\end_inset


\end_layout

\begin_layout Section*
Optimization and optimal control
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
The whole problem can be decomposed into parts - each part listed below
 is a problem or a method that needs to be adressed.
\end_layout

\begin_layout Itemize
Model for system work
\end_layout

\begin_deeper
\begin_layout Itemize
State equations for system components
\end_layout

\begin_layout Itemize
State variables
\end_layout

\begin_layout Itemize
Control parameters
\end_layout

\begin_layout Itemize
Boundary conditions
\end_layout

\begin_deeper
\begin_layout Itemize
Using models for equations for hardware
\end_layout

\begin_layout Itemize
Models for sunlight and power demand
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
Optimization
\end_layout

\begin_deeper
\begin_layout Itemize
Used optimization methods
\end_layout

\begin_deeper
\begin_layout Itemize
Methods of global optimization
\end_layout

\begin_layout Itemize
methods of optimal control
\end_layout

\begin_deeper
\begin_layout Itemize
Discrete
\end_layout

\begin_layout Itemize
Continuous
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
Parameters to optimize
\end_layout

\begin_deeper
\begin_layout Itemize
System parameters
\end_layout

\begin_layout Itemize
(Control parameters)
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
Implementation
\end_layout

\begin_deeper
\begin_layout Itemize
Computer program, algorithm
\end_layout

\begin_layout Itemize
Ways to handle not apriori known data in the application
\end_layout

\end_deeper
\begin_layout Plain Layout
In general, our problem is either discretized, or continuous.
\end_layout

\begin_layout Plain Layout
Parts of optimal control solves the problem of controlability and observability
 and the presence of noise.
\end_layout

\begin_layout Plain Layout
When we add probabilty to the problem, we will be dealing with markov chains
 theory.
 - popsano v LA5.pdf
\end_layout

\begin_layout Plain Layout
Linear Quadratic can be solved analytically and leads to riccati type of
 equations.
 With noise, for example, we call the problem LQG, as for a gaussian noise.
\end_layout

\begin_layout Plain Layout
We get hamilton jacobi bellman equation by going to the limit with a discretized
 version of dynbamic programming.
 ok
\end_layout

\begin_layout Plain Layout
Numerical optimal control pdf - techniky jak to resit.
 Zbejva jeste popsat numericky reseni.
\end_layout

\begin_layout Plain Layout
Pontryagin maximal principle is an necessary condition for extremal point,
 derived from the calculus of variations and accounts in with a parameter
 called costate, that is derived as a lagrange multiplier in case of constraints.
\end_layout

\begin_layout Plain Layout
Zbejva poznat:
\end_layout

\begin_layout Plain Layout
transfevarsabiloity condition->
\end_layout

\begin_layout Plain Layout
co obecne delat s omezenim na -> stav, v prubehu stav, na konci stav; control,
 v prubehu na control, na konci na control
\end_layout

\begin_layout Plain Layout
co s tim ze nekde se rikalo ze nekde plati multiplikatory a nekde ne?->
\end_layout

\begin_layout Plain Layout
numopticon.pdf - super zdroj
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Optimization is a rich field with many subproblems arising from the specific
 problems settings.
 Optimal control is applied optimization together with variational calculus
 
\begin_inset CommandInset citation
LatexCommand cite
key "milyutin1999calculus"

\end_inset

 and has similar subproblems.
\end_layout

\begin_layout Standard
As (global) optimization is concerned about finding the minimum of a function
 with number of parameters, optimal control theory takes this idea to the
 next step and solves minimum of a functional (
\begin_inset Quotes eld
\end_inset

objective function
\begin_inset Quotes erd
\end_inset

 or 
\begin_inset Quotes eld
\end_inset

cost function" 
\begin_inset Formula $J$
\end_inset

 that consists of final time objective and integrated Lagrangian) of a dynamic
 system, evolving in time, controlled by a function (system dynamics).
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\mbox{minimize}\,J & =\phi(x(T),T)+\int_{0}^{T}L(x,u,t)\,dt\tag*{...cost function / objective function}\\
\dot{x} & =f(x,u,t)\tag*{...system dynamics}\\
x(0) & =x_{0}\\
g(x,u,t) & \leq0\tag*{...constraints}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
In free final time, the function 
\begin_inset Formula $\phi$
\end_inset

 is not present.
\end_layout

\begin_layout Standard
Problems from calculus of variations can be formulated as an optimal control
 problem, so the ideas from this field apply in optimal control too.
 Moreover, optimal control theory has methods for solving the problem of
 controllability and observability and the presence of noise.
\end_layout

\begin_layout Subsubsection*
Basic terms
\end_layout

\begin_layout Standard
Optimization problems have many subclasses (as the picture shows) and optimal
 control is not an exception.
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename treeoptimiz.gif
	lyxscale 20
	width 50text%

\end_inset


\begin_inset Note Note
status open

\begin_layout Plain Layout
Optimization Tree, neos.mcs.anl.gov DOD reference jak se to da delat a k tomu
 i ukazky rovnic a tak.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
So, in formulating the problem, there are many decisions that need to be
 made, or many features, that can be adressed.
 To get a grasp of the field, lest summarize the most common features (more
 details can be found in the book 
\begin_inset CommandInset citation
LatexCommand cite
key "bertsekas1995dynamic"

\end_inset

 and the developement of this field over time is summarized in the article
 
\begin_inset CommandInset citation
LatexCommand cite
key "sargent2000optimal"

\end_inset

).
\end_layout

\begin_layout Standard
First, the problem can be formulated in 
\series bold
finite time
\series default
 or 
\series bold
infinite time
\series default
, or the 
\series bold
time can be varied
\series default
 too (
\begin_inset Quotes eld
\end_inset

free time, fixed endpoint
\begin_inset Quotes erd
\end_inset

 problem vs 
\begin_inset Quotes eld
\end_inset

fixed time free endpoint
\begin_inset Quotes erd
\end_inset

).
 The model can be
\series bold
 continuous
\series default
 or 
\series bold
discrete
\series default
, not only in 
\series bold
time, but also in states
\series default
.
 Lastly, we can account for 
\series bold
statistical uncertainities
\series default
.
\begin_inset Note Note
status open

\begin_layout Plain Layout
reference
\end_layout

\end_inset

 When we add probabilty to the problem, we will be dealing with markov chains
 theory.
\begin_inset Note Note
status open

\begin_layout Plain Layout
- popsano v LA5.pdf
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The goal, control policy, can be made 
\series bold
open loop
\series default
 or 
\series bold
closed loop
\series default
 formulation.
 Closed loop does care for values and decisions in intermediate states,
 whereas open loop control has the control function predetermined in advance
 and not relying on intermedate states and values.
 Methods for solving optimal control problems are 
\series bold
dynamic programming
\series default
, 
\series bold
Hamilton Jacobi Bellman (HJB) equations
\series default
 and 
\series bold
Pontryagin maximum principle
\series default
 (or minimum principle, it doesn't matter and is called by both names in
 literature).
 Only some of the problems can be solved analytically, for example the class
 of 
\series bold
linear quadratic control
\series default
 problems, that can be solved through Riccati equations.
\begin_inset Note Note
status open

\begin_layout Plain Layout
reference
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Long story short, there are two main approaches - direct methods and indirect
 methods.
 Indirect methods take the optimal control problem and reformulate it as
 differential equation problem with possible boundary conditions - this
 approach is best used for continuous functions, of course.
 Direct methods view the problem as a problem of nonlinear programming
\end_layout

\begin_layout Standard
Both approaches are supported by the strength of calculus of variations
 
\begin_inset CommandInset citation
LatexCommand cite
key "gelfand1964calculus"

\end_inset

 and both approaches are actually used in numerical solutions.
\end_layout

\begin_layout Subsubsection*
Hamiltonian of the system
\end_layout

\begin_layout Standard
Many problem formulations could be efficiently written using Hamiltonian
 of the system.
 We will use it too, so lets state the Hamiltonian as a Lagrangian (from
 cost function) plus adjoint variable times system dynamics.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
H(x,u,\lambda,t) & = & L(x,u,t)+\lambda^{T}f(x,u,t)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
Said efficiency comes from the fact, that the system dynamics is a sort
 of a constraint and we translate constrained optimization problem to unconstrai
ned - the adjoint variable comes from this idea to introduce lagrangian
 multipliers (as in 
\begin_inset CommandInset citation
LatexCommand cite
key "EvansControlCourse,Lewis2012optimal,bryson1975applied"

\end_inset

) or from HJB equations (there are two ways to get the equations presented
 later, one gives the name 
\begin_inset Quotes eld
\end_inset

adjoint variable" to one of the derivatives, so it is conveniet to use the
 name).
 It is essential for formulations, that will come later.
 Lets just note here, that Hamiltonian is constant for systems with parametres
 undependent on time.
\end_layout

\begin_layout Standard
To summarize, the problem is then to optimize the vallue of Hamiltonian
 - finding such optimal control function 
\begin_inset Formula $u$
\end_inset

, state function 
\begin_inset Formula $x$
\end_inset

 and costate function 
\begin_inset Formula $\lambda$
\end_inset

.
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$u$"
description "usuall notation for control function"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$x$"
description "usuall notation for state"

\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$\\lambda$"
description "usual notation for costate"

\end_inset


\end_layout

\begin_layout Subsubsection*
Dynamic programming
\end_layout

\begin_layout Standard
Dynamic Programming is a principle well known for problems, that can be
 decomposed into smaller subproblems.
 The principle is easy - if the optimal solution of a problem can be composed
 from optimal solutions of subproblems, we can use this information to build
 the solution.
 Whenever this is true (needs for example additive cost function), we just
 dont need to search the whole state space, but we can construct the solution
 by constructing subsolutions one from another in a clever order.
 One example from other field is the problem of finding the shortest path
 in a graph.
\begin_inset Note Note
status open

\begin_layout Plain Layout
reference na nejaky jiny problemy kde se resi, nebo na knizku co jeste nemam
 referencovanou
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Dynamic programming needs discretized problem formulation, but going to
 the limit gives rise to the HJB equations.
\end_layout

\begin_layout Subsubsection*
Hamilton-Jakobi-Bellman equations
\end_layout

\begin_layout Standard
HJB eq.
 are partial differential equations of the problem (here we need the Hamiltonian
), the last equation is just system dynamic written using Hamiltonian:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
J^{\star}(x(T),T) & =\phi(x(T),T)\\
-\frac{\partial J^{\star}}{\partial t} & =\min_{u}H(x,u,J_{x}^{\star},t)=\min_{u}H(x,u,J_{x}^{\star},t)=L(x,u,t)+J_{x}^{\star}f(x,u,t)\\
\dot{x} & =\frac{\partial H}{\partial\lambda}=f\tag*{...state equation}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
When using this apporach, the first step is to solve to get the optimal
 value function first and from that the other values.
\begin_inset Note Note
status open

\begin_layout Plain Layout
control course strana 76
\end_layout

\end_inset

 Hamilton-Jakobi-Bellman equations from optimal control gave life to the
 theory of viscosity solutions, more can be found in articles 
\begin_inset CommandInset citation
LatexCommand cite
key "bardi2008optimal,dragoniintroduction,liu2013introduction"

\end_inset

.
 Theese equations can be solved using finite element methods, but their
 stability is said not to be good.
\begin_inset Note Note
status open

\begin_layout Plain Layout
reference
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
Pontryagin principle of maximality, PMP
\end_layout

\begin_layout Standard
The last step - or method - principle of maximality (Pontryagin principle
 of maximality, PMP), can be - for continuous control functions - derived
 using the HJB equations (as in 
\begin_inset CommandInset citation
LatexCommand cite
key "bertsekas1995dynamic"

\end_inset

).
 Using that, we get to formulate equations for adjoint variable - the first
 equation is pontryagin maximum principle and the second we get by differentiati
ng HJB equation, as in 
\begin_inset CommandInset citation
LatexCommand cite
key "diehl2011numerical"

\end_inset

.
 The last condition is the transversality condition for fixed time free
 endpoint problem.
\begin_inset Note Note
status open

\begin_layout Plain Layout
ControCourse str 47 ...
 DOD ja kto vypada pro jiny je na dalsich strankach str 64?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
And to get 
\begin_inset Formula $u^{\star}$
\end_inset

 using HJB and Minimum principle: numerical optimal control pdf str 14,17
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
u^{\star}(t,x,\lambda) & =\arg\min_{u}(H(x,u,\lambda,t))\phi(x(T),T)\\
-\dot{\lambda} & =\frac{\partial H}{\partial x}=\frac{\partial f^{T}}{\partial x}\lambda+\frac{\partial L}{\partial x}\\
\lambda(T) & =\nabla\phi(x(T),T)
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
pro free endpoint, fixed time je tam jeste Hamiltonian konstantni a lambda(T)=gr
ad phi.
 Pro fixed endpoint, free time je tam Hamiltonian = 0 a neni tam ta rovnice
 s lambda(T) (control course str 48 asi)
\end_layout

\end_inset


\end_layout

\begin_layout Standard
As was said, we get the same results even from the perspective of taking
 the system dynamic as constraint for lagrange multipliers.
\end_layout

\begin_layout Standard
In the presence of state constraints 
\begin_inset Formula $x\in R=\{x\in\mathbb{R}^{n},\,g(x)\le0\}$
\end_inset

, PMP is formulated a bit differently 
\begin_inset CommandInset citation
LatexCommand cite
key "EvansControlCourse"

\end_inset

 - we need to define a function 
\begin_inset Formula 
\[
c(x,u)=\nabla g(x)\cdot f(x,u)
\]

\end_inset

 and the costate equation becomes: 
\begin_inset Formula 
\[
-\dot{\lambda}=\frac{\partial H}{\partial x}(x,u,t)+\mu\frac{\partial c}{\partial x}(x,u)
\]

\end_inset

While the PMP now states the existence of the function 
\begin_inset Formula $\mu:\,[0,T]\rightarrow\mathbb{R}$
\end_inset

.
\end_layout

\begin_layout Standard
Needed to say, that PMP equations are only necessary condition for optimality,
 so analytical proof of existence and uniqueness is needed.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
DOD jake metody k tomu, relaxation atp...
\end_layout

\end_inset


\end_layout

\begin_layout Standard
All theese analytic methods will give us equations, to solve the equations
 is a concern of numerical optimal control.
\end_layout

\begin_layout Subsection*
Numerical optimal control
\end_layout

\begin_layout Standard
Numerical optimal control can be, again, used to solve continuous or discretized
 problems.
 Heavily relies on the problem analysis and follows the said methods.
 It would seem, that it is sufficient to just solve HJB PDR's, but it is
 not used everytime.
 For example, the problem is the, so called, curse of dimensionality - when
 state and/or control, has many components, the problem becomes exponentially
 hard to solve.
 Suggested remedy, in the article 
\begin_inset CommandInset citation
LatexCommand cite
key "diehl2011numerical"

\end_inset

, is, for example, to approximate value function by neural network methods.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
and, in fact it is really used in practise
\end_layout

\end_inset

 Second guide, to know when to use state and costate equations, is, that
 when we want to have continuous control function, we can just solve the
 boundary value problem (as in, for example, 
\begin_inset CommandInset citation
LatexCommand cite
key "wang2009solving"

\end_inset

).
 When we want to allow discontinuities, we need to rewrite the problem to
 nonlinear optimization problem (an excellent book about this topic is 
\begin_inset CommandInset citation
LatexCommand cite
key "chachuat2007nonlinear"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
a obsahuje info o sensitivity eqs ktery sou asi potreba pro nejakejch numerickej
ch metodach ic-32 str 183 sensitivity eqvs
\end_layout

\begin_layout Plain Layout
ic-32 str 50 IPOPT, rfsqp, (ic32 str 32, also optimmatlab str?) ic-32 str
 183 sensitivity eqvs SENSITIVITU a cist handouty
\end_layout

\begin_layout Plain Layout
---co se sensitivitou: staci zderivovat podle controlfunkce pod integralem.
 Viz oc-3solution 
\end_layout

\begin_layout Plain Layout
---OK a co se sensitivitou control parameters that are only numerical in
 multipleshooting? Rekneme nastavit na nulu.
 --Cist o exist a jednozn.
 --Cist Dynam.pdf --acado- --tududum hessian ill conditioned ----multilevel
 methods, vlastni optim,zmenit formulaci, randomguesser ---matlab mpcmove
 -datasets from: http://www.networkrevolution.co.uk/project-library/dataset-tc5-enh
anced-profiling-solar-photovoltaic-pv-users/ ---http://www.sciencedirect.com/scien
ce/article/pii/001374807790050X ---book votetaukis seferlis (baterie) ---projet
 celou slozku modely systemu, zatim jsem u book votetaukis, lead acid accumulato
r, udelat pro lead accid accumulator i diferencialni verzi.
 http://www.springer.com/mathematics/analysis/book/978-1-4471-4819-7 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Itemize
HJB Equations - tabulation in state space
\end_layout

\begin_layout Itemize
Indirect methods, Pontryagin - solve boundary value problem
\end_layout

\begin_layout Itemize
Direct Methods - change to nonlinear programming
\end_layout

\begin_deeper
\begin_layout Itemize
Single shooting - discretized controls to NLP
\end_layout

\begin_layout Itemize
Multiple shooting - controls and node start values discretized
\end_layout

\begin_layout Itemize
Collocation - disretized controls and states
\end_layout

\end_deeper
\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Numerical optimal control cases
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
As said above, the main classes are 
\series bold
indirect methods
\series default
 (first optimize then discretize) and 
\series bold
direct methods
\series default
 (first discretize, then optimize).
 Indirect methods results in algorithms similar to ODE solvers, but the
 resulting system can be badly conditioned or unstable.
 Direct methods just rewrite the problem to the area of nonlinear programming
 problem and then apply convenient solver.
\end_layout

\begin_layout Standard
There are three main cases of direct methods - single shooting, Multiple
 shooting and collocation.
\end_layout

\begin_layout Standard
Single shooting discretizes the control to piecewise constant function and
 uses numerical integrator for the evaluation of the cost function (ODE).
 This way we get a finite dimensional optimization problem, which can be
 solved by any nonlinear programming algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "OptcontrNLP"

\end_inset

, more in section below.
\end_layout

\begin_layout Standard
Single shooting algorithm is usefull, but the stability can sometimes depend
 heavily on starting value.
\end_layout

\begin_layout Standard
Collocation discretizes both the control function and state function and
 approximates the integral.
 We get larger system for nonlinear programming, but the good news is that
 the system is sparse (in the meaning, that the Jacobians have many zero
 elements).
 Collocation can treat better even unstable systems, but refining the grid
 results in new problem with higher dimensions.
\end_layout

\begin_layout Standard
Multiple shooting discretizes the control, as single shooting, and additionally
 the time scale.
 So it is multiple shooting, because it is like running single shooting
 algorithm again from the starting times 
\begin_inset Formula $t_{i}$
\end_inset

.
 Of course we need to add constraints for continuity (the end values from
 the previous interval to be the same as the starting values on the next
 interval).
 Multiple shooting is only block sparse, but is easy to paralelize and can
 treat even unstable systems well.
\begin_inset Note Note
status open

\begin_layout Plain Layout
toliko numericaloptimalcontrol.pdf ted jde jen o to to trochu lip popsat
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Numerous implementations of numerical optimal control are availible, namely
 
\begin_inset CommandInset citation
LatexCommand cite
key "Houska2011a"

\end_inset

.
\begin_inset Note Note
status open

\begin_layout Plain Layout
dod pridat pozn ze to pouzijeme if to pouzijeme
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph*
Nonlinear programming (NLP)
\end_layout

\begin_layout Standard
Is an area of algorithms for optimizing nonlinear cost functions (on constrained
 and unconstrained sets).
 Methods include derived algorithms from ideas of gradient descend or newton
 method (applied on finding a point where the gradient is zero), for example.
 Usually these methods can also make use of derivatives (with said newton
 method on forst derivative we, for example, need also second derivatives)
 and that, in case of optimal control and optimizing differential equations,
 leads to the need of computing sensitivity equations.
 That means how the functional depends on the choice of (discretized) control
 function 
\begin_inset Formula $\frac{\partial J}{\partial u_{i}}$
\end_inset

.
 When not supplied, methods usually compute these just by approximating.
 Algoritmical approaches for getting the results for sensitivity are, for
 example External Numerical Differentiation (END), Variational Differential
 Equations, Automatic Differentiation, Internal Numerical Differentiation
 (IND) (that makes use of the equations written directly in source code
 for numerical computation).
\end_layout

\begin_layout Standard
More details about computing sensitivity equations are for example in 
\begin_inset CommandInset citation
LatexCommand cite
key "Sensitivity20061553"

\end_inset

.
\end_layout

\begin_layout Standard
Also a suggested technique is, for example, Sequential quadratic programming,
 SQP, 
\begin_inset CommandInset citation
LatexCommand cite
key "boggs1995sequential"

\end_inset

, 
\begin_inset CommandInset citation
LatexCommand cite
key "ottanumerical"

\end_inset

.
 It is a method for solving nonlinear problems with second derivatives;
 uses repeated subsolutions of quadratic programming problems.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part*
Solution
\end_layout

\begin_layout Standard
In this section we will apply the theory and methods to our setting and
 problem (trying to focus on issues, that were not answered in other works).
\end_layout

\begin_layout Paragraph*
Our contribution
\end_layout

\begin_layout Standard
Now, lets emphasize, that other existing works tried to model the problem
 using discontinuous functions and optimized only the system parameters
 (for minimial cost) for given power managment strategy or optimized only
 the the power managment strategy (or decision constants of the said strategy).
 So lets ask the question:
\end_layout

\begin_layout Itemize
How will the perception of the problem change for continuous formulation
 of equations?
\end_layout

\begin_layout Itemize
Will there be a case, when it is not valid to suppose, that for all system
 parameters the optimal control strategy is still the same?
\end_layout

\begin_layout Standard
So our aim will be to optimize the global parameters against the cost (using
 global optimization algorithms) but for each test case (values of variables)
 use the methods of optimal control theory to find the best control strategy.
\end_layout

\begin_layout Standard
At the end, we will discuss how can we use ideas from other works (for example
 to switch from Simulated Annealing to Stochastic annealing) or how to use
 the designed method in practical setting.
\end_layout

\begin_layout Standard
In the scope of this work, there will be developed an implementation computing
 the values for an exact desired setting.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
A bylo by super zkusit i nejaky vylepseniny do toho algoritmu, nebo to naprogram
ovat na graficky karte aby toho bylo vic novyho.
\end_layout

\begin_layout Plain Layout
Napad - zkusit tam dat i neco z teorie
\end_layout

\end_inset


\end_layout

\begin_layout Section*
Mathematical formulation
\end_layout

\begin_layout Standard
This section will go smoothly from writing the problem in terms of equations
 to actually applying knowledge and methods for rewriting the problem.
\end_layout

\begin_layout Subsection*
\begin_inset Note Note
status open

\begin_layout Plain Layout
Nadpis: Formulation of the global optimization problem
\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
Formulation of the optimal control strategy
\end_layout

\begin_layout Standard
Since we are using continuous formulation of equations, we are able to follow
 the optimal control theory for continuous cases (thats one difference from
 other works).
\end_layout

\begin_layout Paragraph*
Model using power
\end_layout

\begin_layout Standard
We need to rewrite the setting using mathematical formulation - to express
 the boundary conditions, the state variables 
\begin_inset Formula $x(t)$
\end_inset

, the performance index 
\begin_inset Formula $J()$
\end_inset

, the control function 
\begin_inset Formula $u(t)$
\end_inset

 and the dynamics of the system 
\begin_inset Formula $f(x,u,t)$
\end_inset

 (using notation consistent with the optimal control theory).
 
\end_layout

\begin_layout Standard
Lets express every variable in energy, Joules, with exception for 
\begin_inset Formula $u_{2}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$u_2$"
description "current flow from hydrogen $A$"

\end_inset

, that will be in ampers (see next).
\end_layout

\begin_layout Standard
Because we have two state variables - the state of charge of the accumulator
 
\begin_inset Formula $B(t)$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$B(t)$"
description "energy stored in the accumulator $J$"

\end_inset

 and the stored hydrogen 
\begin_inset Formula $S(t)$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$S(t)$"
description "stored hydrogen $2F \\cdot mol$"

\end_inset

(in the scripts the units are multiplied by Faradays constant times 
\begin_inset Formula $n_{e}$
\end_inset

 to not do conversion again for electrolyzer and fuelcell), our state is
 two dimensional real valued function 
\begin_inset Formula $x(t)=(x_{1}(t),x_{2}(t))=(B(t),S(t))$
\end_inset

.
 Theese quantities are bounded by 
\begin_inset Formula $B(t)\leq B_{max}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$B_{max}$"
description "maximal energy in battery $J$"

\end_inset

 and 
\begin_inset Formula $S(t)\leq S_{max}$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$S_{max}$"
description "maximum of hydrogen in tank $2F \\cdot mol$"

\end_inset

, bounds to maximal battery charge and maximal hydrogen stored (in means
 of power we used to create the hydrogen).
 
\end_layout

\begin_layout Standard
The boundary condition is 
\begin_inset Formula $P_{src}(t)=P_{in}(t)-P_{demand}(t)$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "$P_{src}$"
description "source power as energy from solar collectors minus electricity demand $W$"

\end_inset

, difference between input power and power demand (so its units will be
 Watts).
\end_layout

\begin_layout Standard
The control function 
\begin_inset Formula $u$
\end_inset

 is a two dimensional function of time and will define the power flow:
\end_layout

\begin_layout Itemize
the first component tells us about charging/discharging the battery:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Formula 
\[
\dot{(B)}(t)=P_{batt}(u_{1})-\sigma B(t)
\]

\end_inset


\end_layout

\begin_layout Standard
Using this equation we can model the less than one efficiency by setting
 
\begin_inset Formula $P_{batt}(u_{1})=u_{1}\eta_{batt}$
\end_inset

 and the result of auto discharge 
\begin_inset Formula $\sigma$
\end_inset

.
\end_layout

\begin_layout Itemize
\begin_inset Formula $u_{1}>0$
\end_inset

 ...
 We are charging the battery, using the power 
\begin_inset Formula $u_{1}$
\end_inset

.
 There is a bound, how much power can we give to the battery 
\begin_inset Formula $u_{1}\in[P_{batt+min},P_{batt+max}]$
\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $u_{1}=0$
\end_inset

 ...
 Battery disconnected
\end_layout

\begin_layout Itemize
\begin_inset Formula $u_{1}<0$
\end_inset

 ...
 We are discharging the battery, getting the power 
\begin_inset Formula $-u_{1}$
\end_inset

.
 There is a bound, how much power can we get from battery 
\begin_inset Formula $-u_{1}\in[P_{batt-min},P_{batt-max}]$
\end_inset


\end_layout

\end_deeper
\begin_layout Itemize
The second component tells us about the current flowing from the hydrogen
 source:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Formula 
\[
\dot{(S)}(t)=P_{H_{2}}(u_{2})
\]

\end_inset


\end_layout

\begin_layout Standard
Definitely the term will be different for 
\begin_inset Formula $u_{2}$
\end_inset

 positive and negative, because this equation models two different devices:
\end_layout

\begin_layout Itemize
\begin_inset Formula $u_{2}>0$
\end_inset

 ...
 The electrolyzer is turned on, using the power
\begin_inset Formula $P_{H_{2}}(u_{2})$
\end_inset

.
 There is a bound, how much current can flow 
\begin_inset Formula $u_{2}\in[P_{H_{2}+min},P_{H_{2}+max}]$
\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $u_{2}=0$
\end_inset

 ...
 No change in hydrogen supply
\end_layout

\begin_layout Itemize
\begin_inset Formula $u_{2}<0$
\end_inset

 ...
 The fuel cell is turned on, giving us the power 
\begin_inset Formula $P_{H_{2}}(u_{2})$
\end_inset

.
 There is a bound, how much current we can get 
\begin_inset Formula $-u_{2}\in[P_{H_{2}-min},P_{H_{2}-max}]$
\end_inset


\end_layout

\begin_layout Standard
Again, here we can model the efficiency (for example 
\begin_inset Formula $P_{H_{2}}(u_{2})=\frac{N_{cell}u_{2}}{2F\eta_{F}}\eta_{H_{2}}$
\end_inset

 for 
\begin_inset Formula $u_{2}<0$
\end_inset

 - the current would flow to the fuelcell so we use the equation for fuelcell
 times efficiency) and even nonlinear characteristics of the efficiency.
 This design follows the wise rule, that the electrolyzer and fuel cell
 should not operate simultaneously (because that would be a waste of power).
 The bounds are, for example, the technical specifications set by manufacturer.
 Why do we use current for 
\begin_inset Formula $u_{2}$
\end_inset

 and not power? Because the model equations give us how the voltage depends
 on current (and from that we can get the power dependency on current and
 thats the function 
\begin_inset Formula $P_{H_{2}}(u_{2})$
\end_inset

).
\end_layout

\end_deeper
\begin_layout Standard
Also in many cases in literature, the result of the analysis of the optimal
 control problem is, that the actuall control function is so called bang-bang
 control or bang-off-bang control.
 These controls are called in this way, because they only use extreme allowed
 values and zero (turned off).
 In our case it would not be wise to follow this path, because the efficiency,
 in the means of power, varies.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Zbyva tam pridat nejakej fakt o tom, ze neni dobry moc zapinat a vypinat
 elektrolyzer a fuelcell stridave za sebou - nejaky penale (v Joulech) za
 zapinani a vypinani?
\end_layout

\begin_layout Plain Layout
Pak pridat slozity vztahy, mozna i implicitni.
 - Pridat fakt odkud mam ty rovnice.
\end_layout

\begin_layout Plain Layout
Malek chce jak ty rovnice vznikly.
 Kapitolku o tom.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
So, once again and nicely written, the dynamics of our system is: 
\begin_inset Formula 
\begin{eqnarray*}
\dot{x} & = & f(x,u,t)\\
\dot{\left[\begin{array}{c}
B(t)\\
S(t)
\end{array}\right]} & = & \left[\begin{array}{c}
P_{batt}(u_{1})\\
P_{H_{2}}(u_{2})
\end{array}\right]+\left[\begin{array}{c}
-\sigma\cdot B(t)\\
0
\end{array}\right]
\end{eqnarray*}

\end_inset

To finish our formulation, we want to find the minimizing control function
 
\begin_inset Formula $u^{\star}$
\end_inset

 (and the corresponding minimizing trajectory 
\begin_inset Formula $x^{\star}$
\end_inset

 and costate 
\begin_inset Formula $\lambda^{\star}$
\end_inset

 - will be introduced later) to minimize the performance index
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
J=\phi(x(T),T)+\int_{0}^{T}L(x,u,t)\,dt=hcost(S(T))+bcost(B(T))+\int_{0}^{T}pcost(P_{src}-P_{batt}-P_{H_{2}})\,dt
\]

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $hcost(x)$
\end_inset

 is a function that gives a price for hydrogen
\begin_inset Note Note
status open

\begin_layout Plain Layout
pridej info o jednotkach a predelej z u na to co pouzivas ve skutecnosti
\end_layout

\end_inset

, 
\begin_inset Formula $bcost(x)$
\end_inset

, price for power in the battery and 
\begin_inset Formula $pcost(x)$
\end_inset

 is a function that translates power exchange with the grid to its money
 cost.
 Generally 
\begin_inset Formula $pcost(0)=0,\,pcost(x)\cdot x\geq0,\,|pcost(x)|\leq|pcost(-x)|$
\end_inset

 and all the functions are bounded on bounded intervals.
\end_layout

\begin_layout Standard
That simply says, that for not using the grid we pay nothng, selling gives
 us money, by buying we lose money and that selling the power to grid wouldnt
 give us such an amount of money as we would lose by buying the power.
\end_layout

\begin_layout Standard
Genrally we can think of any 
\begin_inset Formula $pcost$
\end_inset

 function, in the solution and scrupts below we will simply use 
\begin_inset Formula $pcost(x)=c_{1}x\mbox{ if }x\geq0\mbox{, otherwise }=c_{2}x$
\end_inset

, for 
\begin_inset Formula $c_{1},c_{2}\geq0$
\end_inset

.
\end_layout

\begin_layout Standard
As we will see later, the most important thing is, that the function 
\begin_inset Formula $J[y]$
\end_inset

 would be continuous.
\begin_inset Note Note
status open

\begin_layout Plain Layout
dod function or functional
\end_layout

\end_inset


\end_layout

\begin_layout Subparagraph*
Note
\end_layout

\begin_layout Standard
If we wanted to not optimize the cost, but the effectivity (in means of
 power), we would simply use 
\begin_inset Formula $L(x,u,t)=|P_{src}-P_{batt}-P_{H_{2}}|,\,\phi=0$
\end_inset

.
\end_layout

\begin_layout Standard
Thats exactly the power, we are outputting to the net (or withdrawing from)
 over selected time interval 
\begin_inset Formula $[0,T]$
\end_inset

.
 We are not interested in the final value (even not in minimizing any function
 of the final state) so it is classified as final state free problem.
\end_layout

\begin_layout Paragraph*
Models for business problems
\end_layout

\begin_layout Standard
As a note, every optimal control problem, whose aim is to find the optimal
 strategy and the minimum of the functional, can be upgraded so it can compute
 parameters for the most economic installation.
 The adjustment is just adding parameters to the equation, that will allow
 us to use components with different efficiency and tie these to a cost.
 The cost, in turn, can then be added to the cost functional (with keeping
 eye that then the physical units will become a currency and making and
 adjustments) and the parameters can be also passed to the numerical optimalizat
or.
\end_layout

\begin_layout Standard
For the testing run in the scripts attached, very simple models are used,
 that bind the efficiency quadraticaly to cost (bounded on an interval).
\end_layout

\begin_layout Subsubsection*
Construction of solutions and rewriting the problem
\end_layout

\begin_layout Standard
Now we will look at different formulations and use methods like in literature,
 that will give us necessary conditions for minimality, even from different
 views.
\end_layout

\begin_layout Paragraph*
Hamiltonian
\end_layout

\begin_layout Standard
The Hamiltonian of our system, using 
\begin_inset Formula $\lambda\in\mathbb{R}^{2}$
\end_inset

 as lagrange multipliers is 
\begin_inset Formula 
\begin{eqnarray*}
H(x,u,\lambda,t) & = & L(x,u,t)+\lambda^{T}f(x,u,t)\\
 & = & |P_{src}-P_{batt}-P_{H_{2}}|+\lambda_{1}(P_{batt}(u_{1})-\sigma\cdot B(t))+\lambda_{2}P_{H_{2}}(u_{2})
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
By the way, because our state equations does not depend on time, our Hamiltonian
 is constant.
 If we would include, that, for example, the battery gets old and less efficient
 in time, the hamiltonian will suddenly become non constant.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO pridat formulaci pro omezeny state a costate - ze control.course pdf
 str 64
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Additionally, in the presence of state constraints 
\begin_inset Formula $x\in[0,B_{max}]\times[0,S_{max}]\iff\{x\in\mathbb{R}^{2},\,g(x)\le0,\,g(x)=-((x_{1}-\nicefrac{1}{2}B_{max})^{2}+\nicefrac{1}{4}B_{max}^{2})((x_{2}-\nicefrac{1}{2}S_{max})^{2}+\nicefrac{1}{4}S_{max}^{2})\}$
\end_inset

, we need to define a function 
\begin_inset Formula $c(x,u)=\nabla g(x)\cdot f(x,u)$
\end_inset


\end_layout

\begin_layout Paragraph*
Conditions for minimum
\end_layout

\begin_layout Standard
Other (necessary) conditions for minimum are:
\begin_inset Note Note
status open

\begin_layout Plain Layout
Optimal COntrol str 124.
\end_layout

\end_inset

 (state equation, costate equation, boundary conditions)
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\dot{x} & =\frac{\partial H}{\partial\lambda}=f\tag*{...state equation}\\
-\dot{\lambda} & =\frac{\partial H}{\partial x}=\frac{\partial f^{T}}{\partial x}\lambda+\frac{\partial L}{\partial x}\tag*{...costate equation}\\
x(t_{0}) & =(0,0)\tag*{...boundary condition}\\
(\phi_{x}+\psi_{x}^{T}\nu-\lambda)^{T}|_{T}dx+(\phi_{t}+\psi_{t}^{T}\nu+H)^{T}|_{T}dT & =0\tag*{...boundary condition prototype}\\
\lambda^{T}|_{T}dx+H^{T}|_{T}dT & =0\tag*{...boundary condition in our case\ensuremath{(dT=0)}}\\
\lambda_{i}(T) & =\frac{\partial\phi}{\partial x_{i}}(x(T),T)\tag*{...boundary condition for costate (for free final state)}\\
\lambda_{i}(T) & =0\tag*{...boundary condition for costate in our case}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
dal ja kto resit je v lec6.pdf
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph*
Pontryagin minimum principle
\end_layout

\begin_layout Standard
Because values of control function are bounded (maybe even discrete for
 degenerated intervals), we need to use Pontryagin maximum principle (we
 are dealing with constrained input problem) “the Hamiltonian must be minimized
 over all admissible 
\begin_inset Formula $u$
\end_inset

 for optimal values of the state and costate.
\begin_inset Quotes erd
\end_inset

 If we had continuous control function, the problem could be tackled by
 more traditional approach using derivative of Hamiltonian with respect
 to 
\begin_inset Formula $u$
\end_inset

.
\end_layout

\begin_layout Standard
In other words 
\begin_inset Formula $H(x^{\star},u^{\star},\lambda^{\star},t)\geq H(x^{\star},u,\lambda^{\star},t)$
\end_inset

 for all admissible 
\begin_inset Formula $u$
\end_inset

.
 (We have this instead of the stationary condition 
\begin_inset Formula $0=\frac{\partial H}{\partial u}=\frac{\partial L}{\partial u}+\frac{\partial f^{T}}{\partial u}\lambda$
\end_inset

)
\begin_inset Note Note
status open

\begin_layout Plain Layout
optimal control str 241
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In the presence of state constraints, we have 
\begin_inset Formula $ $
\end_inset

 (instead of 
\begin_inset Formula $-\dot{\lambda}=\frac{\partial H}{\partial x}=\frac{\partial f^{T}}{\partial x}\lambda+\frac{\partial L}{\partial x}\mbox{ ...costate equation}$
\end_inset

).
\begin_inset Note Note
status open

\begin_layout Plain Layout
DOD jak to teda formulovat? Ono uz i ta kostavova rovnice je z PMP ...
 
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph*
Hamilton Jacobi Bellman
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Optimal Control str 287 ve me vyvolava pocit ze se hodi definovat do hodnotici
 funkce finalni hodnoceni kolik vodiku zbyde v nadrzi.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The equation for developement of the optimal cost (computed backwards) is
 
\begin_inset Formula 
\begin{eqnarray*}
J^{\star}(x(T),T) & = & \phi(x(T),T)\\
-\frac{\partial J^{\star}}{\partial t} & = & \min_{u}H(x,u,J_{x}^{\star},t)=\min_{u}H(x,u,J_{x}^{\star},t)=L(x,u,t)+J_{x}^{\star}f(x,u,t)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
And to get 
\begin_inset Formula $u^{\star}$
\end_inset

 using HJB and Minimum principle:
\begin_inset Note Note
status open

\begin_layout Plain Layout
numerical optimal control pdf str 14,17
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
u^{\star}(t,x,\lambda) & = & \arg\min_{u}(H(x,u,\lambda,t))\phi(x(T),T)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Subsubsection*
Approach using direct methods
\end_layout

\begin_layout Standard
Above conditions for minimum come from the indirect approach (and allowing
 countable number of disconiuities would araise the need of difficult rewriting
 the problem, as in 
\begin_inset CommandInset citation
LatexCommand cite
key "gelfand1964calculus"

\end_inset

).
 If we would like to use direct methods with functions with disconiuities,
 the thoughts will go in different way.
\end_layout

\begin_layout Paragraph*
Ritz method, finite differences and existence
\end_layout

\begin_layout Standard
As a note about direct methods using 
\begin_inset CommandInset citation
LatexCommand cite
key "gelfand1964calculus"

\end_inset

 as a reference, the direct way to get to the minimum is the following:
\end_layout

\begin_layout Standard
We construct a sequence of spaces 
\begin_inset Formula $\mathcal{M}_{i}$
\end_inset

.
 Each space 
\begin_inset Formula $\mathcal{M}_{i}$
\end_inset

 is defined by basis functions 
\begin_inset Formula $\{\varphi_{i}\}_{i=1}^{n}$
\end_inset

, such that their every linear combination 
\begin_inset Formula $\sum^{n}\alpha_{i}\varphi_{i}$
\end_inset

 then make the whole particular space 
\begin_inset Formula $\mathcal{M}_{i}$
\end_inset

.
 The sequence of spaces will be needed to approximate 
\begin_inset Formula $\mathcal{M}_{1}\subseteq...\subseteq\mathcal{M}_{i}\subseteq...\subseteq\mathcal{M}$
\end_inset

 the space 
\begin_inset Formula $\mathcal{M}$
\end_inset

 in which we would like the solution to lie.
 This is called the Ritz Method.
\end_layout

\begin_layout Standard
Note that the space 
\begin_inset Formula $\mathcal{M}$
\end_inset

 is likely to be infinite dimensional, because the solution is of course
 a control function.
\end_layout

\begin_layout Standard
Such a sequence of spaces is called complete, if for any given 
\begin_inset Formula $y\in\mathcal{M}$
\end_inset

 and 
\begin_inset Formula $\epsilon>0$
\end_inset

 we can have a function 
\begin_inset Formula $y_{n}$
\end_inset

 (of the form of linear combination) that differs less than epsilon from
 the given function - 
\begin_inset Formula $\left\Vert y_{n}-y\right\Vert <\epsilon$
\end_inset

.
\end_layout

\begin_layout Standard
The convergence result is then like this:
\end_layout

\begin_layout Standard
If a functional 
\begin_inset Formula $J[y]$
\end_inset

, 
\begin_inset Formula $y\in\mathcal{M}$
\end_inset

 is continuoous (in the norm of the space 
\begin_inset Formula $\mathcal{M}$
\end_inset

) and if a sequence 
\begin_inset Formula $\mathcal{M}_{i}$
\end_inset

 is complete, then 
\begin_inset Formula $\lim_{n\rightarrow\infty}\mu_{n}=\inf_{y}J[y]$
\end_inset

 (
\begin_inset Formula $\mu_{n}$
\end_inset

's are realized by functions 
\begin_inset Formula $y_{n}\in\mathcal{M}_{n}$
\end_inset

).
\end_layout

\begin_layout Standard
The finite differences idea then says, that the approximation in each particular
 space is done by piecewise linear function.
\end_layout

\begin_layout Standard
Together then, if we have a sequence (
\begin_inset Formula $y_{n}$
\end_inset

) of optimal solutions of our problem - constrained to space 
\begin_inset Formula $\mathcal{M}_{n}$
\end_inset

, then we are approaching the limit if given functional is continuous.
\end_layout

\begin_layout Standard
So, does our problem, from the point of view of direct methods from calculus
 of variations (such a point of view means, that 
\begin_inset Formula $J$
\end_inset

 is cost function and 
\begin_inset Formula $y$
\end_inset

 is our
\begin_inset Formula $u,\,x,\,\lambda$
\end_inset

), have this property?
\end_layout

\begin_layout Standard
Cost for our problem was given by
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
J[x,u]=\phi(x(T),T)+\int_{0}^{T}L(x,u,t)\,dt=hcost(S(u(T),x(T)))+bcost(B(u(T),x(T)))+\int_{0}^{T}pcost(P_{src}(x(t))-P_{batt}(u(t),x(t))-P_{H_{2}}(u(t),x(t)))\,dt
\]

\end_inset


\end_layout

\begin_layout Standard
So, given the fact, that everything comes down to functions 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $P_{batt}$
\end_inset

 and 
\begin_inset Formula $P_{H_{2}}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{eqnarray*}
\dot{\left[\begin{array}{c}
B(t)\\
S(t)
\end{array}\right]} & = & \left[\begin{array}{c}
P_{batt}(u_{1})\\
P_{H_{2}}(u_{2})
\end{array}\right]+\left[\begin{array}{c}
-\sigma\cdot B(t)\\
0
\end{array}\right]
\end{eqnarray*}

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
, that are selected to be continuous (see models up there - it is not only
 physically-wise selection that makes approximating easier, computation
 faster, but it also gives us the needed results here), we just need to
 clarify our demands on functions 
\begin_inset Formula $hcost$
\end_inset

, 
\begin_inset Formula $bcost$
\end_inset

 and 
\begin_inset Formula $pcost$
\end_inset

 - to be continuous.
 Because these functions just translate amouts of physical variable to cost
 in money, we can assume continuity without causing any harm.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
DOD otazka - staci to? Co si muzeme dovolit u funkce pcost? Tam muzeme i
 kmitat ne?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In this analysis we ommited any constraints, but given the fact that the
 constraints are, in the basic sense, constant, not dependent on anything
 (because they just limit the maximal allowed powers of components), they
 are not gonna affect continuity in the presence of multipliers, or any
 clever tricks meant to incorporate them (and they also dont affect the
 existence of minima, because they constrain the spaces on which we are
 finding the minima).
\end_layout

\begin_layout Standard
Our functional is, in the end, easier to work with, than normal problems
 from the calculus of variations, because we dont have derivations of the
 constrol function in our functional.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
-Warga strana 257 nutny conditions - konvexni hamiltonian.
 Jak dal? -Warga 258 poznamka o eulerlagrange lze pouzit jako kriterium
 jestli je potreba relaxed solution -297 exist? --controlcourse.,pdf ...
 controllability nepotrebujeme, protoze finalni stav je volnej -formulaci
 pouzitim bangbang? Procentni? Bude rychlejsi...
 -eulerlagrange rovnice jsou nutna podminka -nojo hamiltonian ale jakmile
 povolom nespojity controls tak co? optimal.control.pdf str 123 ----regularization
 term - when my hessian is not positive definite.
 Add term.
 
\end_layout

\begin_layout Plain Layout
...
\end_layout

\begin_layout Plain Layout
\begin_inset Quotes eld
\end_inset

-asi bude nutny si tu veticku dokazat sam, ale k tomu si prectu to djvu
 applied optimal control, protoze tam bude predpoklady pontryagina OK -add
 jr arthur e bryson OK -ok calculus of variations 
\begin_inset Quotes eld
\end_inset


\end_layout

\begin_layout Plain Layout
...
\end_layout

\begin_layout Plain Layout
-muj funkcional nepotrebuje zadny derivace kontrolni funkce.
 Tedy nepotrebujeme existenci derivaci.
 Povolime jen konecne mnoho nespojitosti (aby se neprepinalo moc casto)
 -prepisu jako sumu integralu po castech spojitejch -section 15 piecewise
 smooth gelfand -gelfand strana 37 ..
 nase variacni derivace je jen derivace dle y, protoze y' se nevyskytuje
 (funkcional na tom nezavisi) -co je vlatne ten muj funkcional? -hohoho
 15 broken extremals! ...
 eh...
 ano dela se to po castech, napsat ze to pak splnuje euler rovnice na castec
 ale dohromady ty variace jsou nula Chap 8 direct methods Gelfand knizka
 popisuje neprime metody, ktery otazku existence resi prevodem na difrov,
 v devaty kapitole konvegrence.
 Tzn primy metody.
 206-if the sequence is always optimal solution, we find the minimizing
 sequence 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
otazky
\end_layout

\begin_layout Plain Layout
\begin_inset Formula $\dot{x}=f(x,u,t):\dot{\left[\begin{array}{c}
SOC(t)\\
S(t)
\end{array}\right]}=\left[\begin{array}{c}
P_{batt}(u_{1})\\
P_{H_{2}}(u_{2})
\end{array}\right]+\left[\begin{array}{c}
-\sigma\cdot SOC(t)\\
0
\end{array}\right]$
\end_inset

 minimize the performance index 
\begin_inset Formula $J=\int_{0}^{T}|P_{src}-P_{batt}-P_{H_{2}}|\,dt$
\end_inset


\end_layout

\begin_layout Plain Layout
poznamky z konzultace s Kurzikem 14082014
\end_layout

\begin_layout Plain Layout
nejdriv jestli to existuje jestli mi ty omezeni na rozsah nezkazi existenci
 - to je potreba overit
\end_layout

\begin_layout Plain Layout
v roubickove knize 260, relaxace proto abych to mohl resit
\end_layout

\begin_layout Plain Layout
rizeni je z kompaktni mnoziny
\end_layout

\begin_layout Plain Layout
box constraints minimalizuju funkci a 
\end_layout

\begin_layout Plain Layout
gradientni metody jsou supr pro konvexni ulohu - tam vlastne vim ze sem
 v minimu.
 Muze bejt lepsi druha mocnina kviuli kvadraticky strukture.
 ta absolutni hodnota
\end_layout

\begin_layout Plain Layout
v numerice to nebude hladky takze na gradient by byl problem, tam by byla
 absolutni hodnota - takze lepsi kvadratickej, to muzu zkusit.
\end_layout

\begin_layout Plain Layout
fortran - optimization tree mittleman - plato asu
\end_layout

\begin_layout Plain Layout
----------->-Numericky kody brat z http://plato.la.asu.edu/bench.html<<-------------
--------------
\end_layout

\begin_layout Plain Layout
---------------
\end_layout

\begin_layout Plain Layout
OTAZKA - Jak vyjadrim, ze u (ridici funkce) a x (stavova promenna) je omezene
 (nejakym uzavrenym intervalem)? Jak se to projevi na rovnicich?
\end_layout

\begin_layout Plain Layout
OTAZKA - Jak postupovat dal? Jaky numericky resic (c++ idealne) se da pouzit?
 Je jich hrozna hromada:
\end_layout

\begin_layout Plain Layout
Hodi se dal posutpovat spis Hamilton jakobi bellmanem, dynamickym programovanim
 s diskretizaci, nebo principem maxima? Co je nejlepsi z hlediska programovyho/n
umerickyho nejrychlejsiho? Co se pouziva?
\end_layout

\begin_layout Plain Layout
OTAZKY ohledne PDR a viskoznich reseni:
\end_layout

\begin_layout Plain Layout
-OTAZKA jak resit pomoci HJB a vizkoznich reseni? Staci MKP? Jak na to?
\end_layout

\begin_layout Plain Layout
-OTAZKA - jsou viskozni reseni zobecneny slabyma resenima z nami zname PDR
 1?
\end_layout

\begin_layout Plain Layout
otazka - Co znamenaji posledni podminky v optimal control strany 123
\end_layout

\begin_layout Plain Layout
others
\end_layout

\begin_layout Plain Layout
OTAZKA - jde nas problem vyresit jako linear quadratic regulator? To pak
 ma analyzticky reseni! a nemusim diskretizovat.
\end_layout

\begin_layout Plain Layout
protiOTAZKA - co by se zmenilo, kdybych tam dal absolutni hodnotu misto
 kvadratu? otazka co by se zmenilo kdybych tam nemel kvadrat, ale absolutni
 hodnotu v hodnotici funkci?
\end_layout

\begin_layout Plain Layout
...
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
hmm pozor jak pridam omezeni na SOC t a S t? Ze do nadrzi se nevejde toho
 moc? Control.Course str 64 - state constrains?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Novej zapis 
\end_layout

\begin_layout Plain Layout
aby pruhledny a stravitelny pro lidicky co budou apikovat a nejjednodussi
 prikladek na tom by se ukazalo
\end_layout

\begin_layout Plain Layout
predikujou na sicilii jaky bude pocasi kolik muzou dodat energie kolik naslibova
t
\end_layout

\begin_layout Plain Layout
energie kterou ziskam ze slunce od vychodu do zapadu nejakou krivku
\end_layout

\begin_layout Plain Layout
neco do vodiku neco do site neco do baterie a to je standart a ono by mohlo
 navrhnout 
\end_layout

\begin_layout Plain Layout
-kdyby 5 dni nekdo neodebiral tak budu vyrabet (tady je za rok 0,42MWh)
 odadnout si to denni mnozstvi a rict si na 5 deset dni ukladat
\end_layout

\begin_layout Plain Layout
a pak bych si cast ulozil do baterky (to zas 50 kwh) a zbytek ukladat a
 prijdou temne dny vybuchne sopka dny s minimalnim osvitem a budu mit pozaavek
 vyzasobovat domecek 20kwh domecek za den
\end_layout

\begin_layout Plain Layout
a vydrzel by na tejden s tou zasobou
\end_layout

\begin_layout Plain Layout
modelovej priklad a ukazat princip a pak by prisla dalsi sekce
\end_layout

\begin_layout Plain Layout
formulace zjednodusena problemu
\end_layout

\begin_layout Plain Layout
budu mit uvod, tam v tom bude prehled proc to delame
\end_layout

\begin_layout Plain Layout
najdu v ty flashce i clanky konkretne rizeni vodikovy jednotky
\end_layout

\begin_layout Plain Layout
cela koncepce bude fotovoltaika nebo jadro a energie se bude ukladat kdyz
 nebude potreba bude se ukladat do hydro nebo spis do vodiku a tan se bude
 tlakovat nebo pohlcovat v hydridech resi se i to uskladnovani
\end_layout

\end_inset


\end_layout

\begin_layout Section*
Implementation and results
\end_layout

\begin_layout Standard
Using all previously mentioned, we developed a computer program answering
 following question 
\begin_inset Quotes eld
\end_inset

What is the optimal control function (or the most economic setting) for
 photovoltaic and hydrogen system and what is the power managment strategy
 of such system?".
 Lets suppose, that we already have measured yearly power consumption and
 have already installed photovoltaic panels and measured power output.
 If it is not this case, we can, of course, use the model and approach from
 
\begin_inset CommandInset citation
LatexCommand cite
key "Stand-alonePowerSystems"

\end_inset

 to get the estimated power output from manufacturers datasheets.
\end_layout

\begin_layout Standard
Lets now have a look at all the implementation details and all the used
 tools (because this way it would make the actual usage of the scripts less
 time consuming work).
\end_layout

\begin_layout Subsection*
Setting up the constants
\end_layout

\begin_layout Standard
The data of generated solar energy and house consumption were taken from
 this dataset 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://www.networkrevolution.co.uk/project-library/dataset-tc5-enhanced-profiling-s
olar-photovoltaic-pv-users/
\end_layout

\end_inset

 (using the monthly average averaged with weekday average for weekdays and
 monthly average averaged with weekends average for weekends) and through
 the scripts, the results are in a file data.txt.
\end_layout

\begin_layout Standard
For setting the constants for electrolyzer and fuelcell empiric models,
 we used the dataset 
\begin_inset CommandInset citation
LatexCommand cite
key "Bauer:www.h2fc-fair.com"

\end_inset

 and a plot digitizer software from 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://plotdigitizer.sourceforge.net/
\end_layout

\end_inset

.
 The model parameters were fitted using MATLAB fitting toolbox (and from
 the results below we can see, that the empiric models are indeed usefull
 and sufficient).
 The source codes are in the directory 
\begin_inset Quotes eld
\end_inset

fit".
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename fittedelectrolyzerplot.png

\end_inset


\begin_inset Graphics
	filename fittedfuelcell.png

\end_inset


\end_layout

\begin_layout Standard
Results of the fitting for electrolyzer (left) and fuelcell (right), x axis
 is current density (
\begin_inset Formula $mA\cdot m^{-2}$
\end_inset

), y axis is voltage (
\begin_inset Formula $V$
\end_inset

).
\end_layout

\begin_layout Standard
Actual values of parameters are kept in the file consts.m together with all
 the other model constants and numerical settings.
\end_layout

\begin_layout Subsection*
The scripts and usage
\end_layout

\begin_layout Standard
First attempt was to use the ACADO optimization toolkit.
 Even though the scripts (and tests) were not able to run completely, the
 source codes using this library are also attached, in the directory AcadoLinear
Version (waiting for the next release of the toolkit).
\end_layout

\begin_layout Standard
The next step was to use MATLAB and to write multiple shooting algorithm
 (as was said, in such a way, that they would reformulate the optimal control
 problem as NLP problem), the formulation is independent on actual solver
 used and so it is able to run with MATLABs original fmincon function and
 with any algorithm from OPTI toolbox (
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://www.i2c2.aut.ac.nz/Wiki/OPTI/
\end_layout

\end_inset

).
\end_layout

\begin_layout Standard
All used and tried approaches to the problem are reported with respective
 sources in these directories:
\end_layout

\begin_layout Itemize
Directory 
\family typewriter
MatlabSinglShooting1
\family default
 contains implementation using single shooting technique.
 This implementation was not effective for this problem.
 In the main directory, there is implementation of multiple shooting using
 fmincon.
\end_layout

\begin_layout Itemize
Directory 
\family typewriter
TrySensitivity
\family default
 contains the same problem implementation with multiple shooting, but with
 employed sensitivity equations for computing the derivatives.
 This approach has not proved to be working effectively (probably because
 the precise computation of the derivatives results in breakdown of the
 algorithm more often, than it did when approximating them).
\end_layout

\begin_layout Itemize
Directory 
\family typewriter
4dformulation
\family default
 contains the code of a slightly differently formulated problem, with 4
 control functions (one for electrolyzer, one for battery input, one for
 battery output and one for fuelcell) in an attempt to try to cure said
 problem with derivatives, using more dimensional problem, with only positive
 valued control functions and more constraints.
 Unfortunately this approach failed, because the resulting matrices in the
 computation were said to be badly conditioned.
\end_layout

\begin_layout Itemize
Directory 
\family typewriter
Opti
\family default
 contains the code for multiple shooting using Opti toolbox solver.
\end_layout

\begin_layout Standard
All the matlab scripts in each directory follow this structure:
\end_layout

\begin_layout Itemize

\family typewriter
main.m
\family default
 - main file, executing in matlab will execute the whole computation
\end_layout

\begin_layout Itemize

\family typewriter
ctr.m
\family default
 - function for computing the constraints (physical and the ones resulting
 from multiple shooting approach)
\end_layout

\begin_layout Itemize

\family typewriter
obj.m
\family default
 - computing the objective function for optimization
\end_layout

\begin_layout Itemize

\family typewriter
fun.m
\family default
 - computing the whole equation, integration over the time
\end_layout

\begin_layout Itemize

\family typewriter
state.m
\family default
 - evaluation of state equation
\end_layout

\begin_layout Itemize

\family typewriter
statesens.m
\family default
 - script for cimputing sensitivity equations
\end_layout

\begin_layout Itemize

\family typewriter
consts.m
\family default
 - file for storing the constants and options defining the problem
\end_layout

\begin_layout Itemize

\family typewriter
dispopt.m
\family default
 - script for displaying graphs
\end_layout

\begin_layout Itemize

\family typewriter
nlpoutfun.m
\family default
 - script for displaying the approximations after each iteration
\end_layout

\begin_layout Itemize

\family typewriter
interpt1qr.m
\family default
 - script for fast linear interpolation of the source data
\end_layout

\begin_layout Itemize

\family typewriter
controldata
\family default
 - points on piecewise lienar function defining the power demands
\end_layout

\begin_layout Standard
Every variation of the scripts can be run in the same manner - executing
 
\family typewriter
main.m
\family default
.
 The solved problem is set to examine the effectivity over one year period.
 Because of this, you can also notice rescaling constants in 
\family typewriter
consts.m
\family default
 - because letting the integrators integrate functions depending on very
 high time ranges in basic physical units (seconds) would take unreasonable
 amount of time (aleso because the boundary conditions are set to change
 on hour by hour basis and that means that nothing interesting happens for
 the numerical integrator that tries to watch for sudden changes and keep
 the precision).
\end_layout

\begin_layout Standard
For more discretization points the program becomes of course slower.
 If you want to see some results earlier, you can set the constants 
\begin_inset Quotes eld
\end_inset

Data.cLogBegin
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

Data.cLogEnd
\begin_inset Quotes erd
\end_inset

 in 
\family typewriter
consts.m
\family default
 to specify at which power of two discretization points to begin and at
 which to end.
 This also affects the selection of the initial values - on the first run
 they are set randomly and on each consecutive run they are copied from
 previous run (this is because the selection of initial point in the search
 space can affect the outcome of certain optimalizators and also their running
 time).
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
The program can operate in different modes:
\end_layout

\begin_layout Enumerate
global and control optimization - searches for the best setting against
 costs using optimal control specific for each test case (i.e.
 runs case 3.
 as a subroutine).
\end_layout

\begin_layout Enumerate
global optimization using PMS - searches for the best setting against costs
 using only defined power managment strategies.
\end_layout

\begin_layout Enumerate
Simulation using optimal control - given the data, uses optimal control
 algorithm to find optimal control for this one case
\end_layout

\begin_layout Enumerate
Simulation using PMS - given the data and PMS, simulates the system
\end_layout

\begin_layout Plain Layout
Source codes and program executables are attached in the electronic version.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
The process
\end_layout

\begin_layout Plain Layout
If we have the daily light data, we use the PV models to transform them
 into daily power data.
 
\end_layout

\begin_layout Plain Layout
...
\end_layout

\begin_layout Plain Layout
TODO
\end_layout

\begin_layout Plain Layout
-add about matlab implementations, acado implementations,
\end_layout

\begin_layout Plain Layout
BVP matlab implementation uplne nejde, protoze constraints.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
Results of test runs
\end_layout

\begin_layout Standard
The scripts will startsolving the problem on discretized control function
 to number of discretization points beggining at 
\begin_inset Formula $2^{\mbox{cLogBeg}}$
\end_inset

 and ending at 
\begin_inset Formula $2^{\mbox{cLogEnd}}$
\end_inset

 (constants from 
\family typewriter
consts.m
\family default
), copying the results from previous run to the next run, because in the
 optimization algorithms, the choice of starting point in the search space
 matters.
 Because of that, some iterations can fail to satisfy the bounds thinking
 that the problem is infeasible - that is automatically fixed when the number
 of discretization points grows bigger.
 Because then there will be more decision points, that can steer the system
 to allowed set of states.
\end_layout

\begin_layout Subsection*
\begin_inset Note Note
status open

\begin_layout Subsection*
Results
\end_layout

\begin_layout Plain Layout
Aside from numerical results for the motivational example (giving us exact
 information about how much batteries, fuel cells and other components to
 buy and what to expect), we saw, that the optimal control strategy was
 / wasnt (<-TODO) different different from the strategy chosen from one
 of previous works.
 vezmi to a nasimuluj vuci nejaky strategii co pouzivali jinde.
\end_layout

\begin_layout Plain Layout
Motivational example results:
\end_layout

\begin_layout Plain Layout
The costs for * were *, tahere were option to use * number of fuel cells,
 fotovoltaic cells, tank sizes, ...
 TODO.
 Then the optimal setting is * and the strategy is *.
 TODO.
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
\begin_inset Note Note
status open

\begin_layout Subsubsection*
Algorithms
\end_layout

\begin_layout Subsubsection*
Using the program
\end_layout

\begin_layout Section*
Results
\end_layout

\begin_layout Paragraph*
Comparing the results
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
printnomenclature 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "bibdata"
options "bibtotoc,alpha"

\end_inset


\end_layout

\end_body
\end_document
